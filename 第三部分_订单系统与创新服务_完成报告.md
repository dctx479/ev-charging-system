# ç¬¬ä¸‰éƒ¨åˆ†ï¼šè®¢å•ç³»ç»Ÿä¸åˆ›æ–°æœåŠ¡ - å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯

- **å¼€å‘æ—¥æœŸ**: 2025-01-12
- **å¼€å‘å†…å®¹**: æ–°èƒ½æºæ±½è½¦å……ç”µç«™ç‚¹ç®¡ç†ç³»ç»Ÿ - è®¢å•ç³»ç»Ÿä¸åˆ›æ–°æœåŠ¡
- **çŠ¶æ€**: âœ… å®Œæˆ

---

## âœ… å·²å®ŒæˆåŠŸèƒ½æ¨¡å—

### 1. å……ç”µè®¢å•ç³»ç»Ÿ

#### åç«¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶:**
- `ChargeOrder.java` - è®¢å•å®ä½“ç±»
- `ChargeOrderRepository.java` - è®¢å•æ•°æ®è®¿é—®å±‚
- `OrderService.java` - è®¢å•ä¸šåŠ¡é€»è¾‘å±‚
- `OrderController.java` - è®¢å•æ§åˆ¶å™¨

**ä¸»è¦åŠŸèƒ½:**
- âœ… å¼€å§‹å……ç”µï¼ˆåˆ›å»ºè®¢å•ï¼‰
  - éªŒè¯å……ç”µæ¡©çŠ¶æ€
  - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¿›è¡Œä¸­çš„è®¢å•
  - ç”Ÿæˆå”¯ä¸€è®¢å•å·ï¼ˆæ ¼å¼ï¼šCO + æ—¶é—´æˆ³ + éšæœºæ•°ï¼‰
  - æ›´æ–°å……ç”µæ¡©çŠ¶æ€ä¸º"å……ç”µä¸­"

- âœ… ç»“æŸå……ç”µ
  - è®¡ç®—å®é™…å……ç”µæ—¶é•¿
  - **å³°è°·å¹³ç”µä»·è®¡ç®—**ï¼š
    - è°·æ—¶ï¼ˆ23:00-07:00ï¼‰: 0.4å…ƒ/kWh
    - å¹³æ—¶ï¼ˆ07:00-10:00, 15:00-18:00, 21:00-23:00ï¼‰: 0.8å…ƒ/kWh
    - å³°æ—¶ï¼ˆ10:00-15:00, 18:00-21:00ï¼‰: 1.2å…ƒ/kWh
  - è®¡ç®—ç”µè´¹ã€æœåŠ¡è´¹ã€æ€»è´¹ç”¨
  - æ›´æ–°å……ç”µæ¡©çŠ¶æ€ä¸º"ç©ºé—²"

- âœ… è®¢å•æ”¯ä»˜
  - æ”¯æŒä¸‰ç§æ”¯ä»˜æ–¹å¼ï¼šå¾®ä¿¡ã€æ”¯ä»˜å®ã€ä½™é¢
  - **è‡ªåŠ¨å‘æ”¾ç¢³ç§¯åˆ†**ï¼ˆå…³é”®åŠŸèƒ½ï¼‰
  - åˆ›å»ºæ”¯ä»˜è®°å½•
  - æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€

- âœ… è®¢å•ç®¡ç†
  - è®¢å•åˆ—è¡¨æŸ¥è¯¢ï¼ˆåˆ†é¡µï¼‰
  - è®¢å•è¯¦æƒ…æŸ¥è¯¢
  - å–æ¶ˆè®¢å•

#### å‰ç«¯å®ç°

**ç”¨æˆ·ç«¯é¡µé¢:**
- `CreateOrder.vue` - åˆ›å»ºè®¢å•é¡µé¢
- `ChargingProgress.vue` - å……ç”µè¿›åº¦é¡µé¢
  - å®æ—¶æ˜¾ç¤ºå……ç”µè¿›åº¦ï¼ˆåŠ¨ç”»æ•ˆæœï¼‰
  - æ˜¾ç¤ºå……ç”µä¿¡æ¯ï¼ˆç”µé‡ã€æ—¶é•¿ã€è´¹ç”¨ï¼‰
  - å®æ—¶ç”µä»·æ˜¾ç¤º
  - ç»“æŸå……ç”µåŠŸèƒ½
- `OrderList.vue` - è®¢å•åˆ—è¡¨é¡µé¢
- `OrderDetail.vue` - è®¢å•è¯¦æƒ…é¡µé¢

---

### 2. æ™ºèƒ½æ’é˜Ÿç³»ç»Ÿ

#### åç«¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶:**
- `QueueRecord.java` - æ’é˜Ÿè®°å½•å®ä½“ç±»
- `QueueRecordRepository.java` - æ’é˜Ÿæ•°æ®è®¿é—®å±‚
- `QueueService.java` - æ’é˜Ÿä¸šåŠ¡é€»è¾‘å±‚
- `QueueController.java` - æ’é˜Ÿæ§åˆ¶å™¨

**ä¸»è¦åŠŸèƒ½:**
- âœ… åŠ å…¥æ’é˜Ÿ
  - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²åœ¨æ’é˜Ÿ
  - æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²å……ç”µæ¡©ï¼ˆæœ‰åˆ™ä¸éœ€æ’é˜Ÿï¼‰
  - ç”Ÿæˆæ’é˜Ÿå·ï¼ˆæ ¼å¼ï¼šç«™ç‚¹ID-æ—¥æœŸ-åºå·ï¼‰
  - è®¡ç®—æ’é˜Ÿä½ç½®å’Œé¢„ä¼°ç­‰å¾…æ—¶é—´
  - è‡ªåŠ¨å°è¯•åˆ†é…å……ç”µæ¡©

- âœ… è‡ªåŠ¨åˆ†é…å……ç”µæ¡©
  - **å®šæ—¶ä»»åŠ¡**ï¼šæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  - æŸ¥è¯¢ç©ºé—²å……ç”µæ¡©
  - æŒ‰æ’é˜Ÿé¡ºåºåˆ†é…å……ç”µæ¡©
  - æ›´æ–°å……ç”µæ¡©çŠ¶æ€ä¸º"é¢„çº¦ä¸­"
  - å‘é€é€šçŸ¥ç»™ç”¨æˆ·

- âœ… æ’é˜Ÿç®¡ç†
  - æŸ¥è¯¢æ’é˜ŸçŠ¶æ€
  - ç¦»å¼€é˜Ÿåˆ—
  - è·å–ç«™ç‚¹æ’é˜Ÿä¿¡æ¯
  - **è¿‡å·æ£€æŸ¥**ï¼šå«å·å15åˆ†é’Ÿæœªå¼€å§‹å……ç”µè‡ªåŠ¨è¿‡å·

#### å‰ç«¯å®ç°

**ç”¨æˆ·ç«¯é¡µé¢:**
- `QueueStatus.vue` - æ’é˜ŸçŠ¶æ€é¡µé¢
  - æ˜¾ç¤ºæ’é˜Ÿå·å’Œä½ç½®
  - æ˜¾ç¤ºé¢„ä¼°ç­‰å¾…æ—¶é—´
  - æ˜¾ç¤ºå‰é¢æ’é˜Ÿäººæ•°
  - ç¦»å¼€é˜Ÿåˆ—åŠŸèƒ½

---

### 3. ç¢³ç§¯åˆ†ä½“ç³»

#### åç«¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶:**
- `CarbonCreditRecord.java` - ç¢³ç§¯åˆ†è®°å½•å®ä½“ç±»
- `CarbonCreditRecordRepository.java` - ç¢³ç§¯åˆ†æ•°æ®è®¿é—®å±‚
- `CarbonCreditService.java` - ç¢³ç§¯åˆ†ä¸šåŠ¡é€»è¾‘å±‚
- `CarbonCreditController.java` - ç¢³ç§¯åˆ†æ§åˆ¶å™¨

**ä¸»è¦åŠŸèƒ½:**
- âœ… å……ç”µè·å¾—ç§¯åˆ†
  - **è®¡ç®—å…¬å¼**: ç§¯åˆ† = å……ç”µé‡(kWh) Ã— 0.785 (ç¢³æ’æ”¾å› å­) Ã— 10
  - æ”¯ä»˜è®¢å•æ—¶è‡ªåŠ¨å‘æ”¾ç§¯åˆ†
  - åˆ›å»ºç§¯åˆ†å˜åŠ¨è®°å½•

- âœ… æ¯æ—¥ç­¾åˆ°
  - åŸºç¡€ç§¯åˆ†ï¼š5åˆ†/å¤©
  - **è¿ç»­ç­¾åˆ°å¥–åŠ±**ï¼šè¿ç»­7å¤©é¢å¤–å¥–åŠ±20ç§¯åˆ†
  - é˜²æ­¢é‡å¤ç­¾åˆ°æ£€æŸ¥

- âœ… ç§¯åˆ†å…‘æ¢
  - å…‘æ¢æ¶ˆè€—ç§¯åˆ†
  - åˆ›å»ºå…‘æ¢è®°å½•
  - æ£€æŸ¥ç§¯åˆ†ä½™é¢

- âœ… ç§¯åˆ†ç»Ÿè®¡
  - å½“å‰ä½™é¢
  - ç´¯è®¡è·å¾—/æ¶ˆè€—
  - æœ¬æœˆè·å¾—/æ¶ˆè€—
  - è¿ç»­ç­¾åˆ°å¤©æ•°

#### å‰ç«¯å®ç°

**ç”¨æˆ·ç«¯é¡µé¢:**
- `CreditCenter.vue` - ç¢³ç§¯åˆ†ä¸­å¿ƒ
  - æ˜¾ç¤ºå½“å‰ç§¯åˆ†ä½™é¢
  - ç­¾åˆ°åŠŸèƒ½
  - ç§¯åˆ†ç»Ÿè®¡å›¾è¡¨
  - å…‘æ¢åŠŸèƒ½å…¥å£
- `CreditHistory.vue` - ç§¯åˆ†å†å²è®°å½•
  - ç§¯åˆ†æ˜ç»†åˆ—è¡¨
  - æŒ‰ç±»å‹ç­›é€‰

---

### 4. å‘¨è¾¹æœåŠ¡æ¨è

#### åç«¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶:**
- `NearbyService.java` - å‘¨è¾¹æœåŠ¡å®ä½“ç±»
- `NearbyServiceRepository.java` - å‘¨è¾¹æœåŠ¡æ•°æ®è®¿é—®å±‚
- `NearbyServiceService.java` - å‘¨è¾¹æœåŠ¡ä¸šåŠ¡é€»è¾‘å±‚
- `NearbyServiceController.java` - å‘¨è¾¹æœåŠ¡æ§åˆ¶å™¨
- `NearbyServiceVO.java` - å‘¨è¾¹æœåŠ¡è§†å›¾å¯¹è±¡

**ä¸»è¦åŠŸèƒ½:**
- âœ… æ™ºèƒ½æ¨èï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
  - **æ ¹æ®ç­‰å¾…æ—¶é—´åŒ¹é…æœåŠ¡**ï¼š
    - æœ€å°æ—¶é—´ï¼šç­‰å¾…æ—¶é—´ Ã— 50%
    - æœ€å¤§æ—¶é—´ï¼šç­‰å¾…æ—¶é—´ Ã— 120%
  - ä¾‹å¦‚ï¼šç­‰å¾…30åˆ†é’Ÿï¼Œæ¨è20-36åˆ†é’Ÿçš„æœåŠ¡
  - æŒ‰è¯„åˆ†å’Œè·ç¦»æ’åº
  - è¿”å›Top 10æ¨è
  - ç”Ÿæˆæ¨èç†ç”±

- âœ… æŒ‰æœåŠ¡ç±»å‹æŸ¥è¯¢
  - 1-é¤é¥®ã€2-å’–å•¡å…ã€3-è´­ç‰©ã€4-å¨±ä¹ã€5-å…¶ä»–

- âœ… æŒ‰è·ç¦»æŸ¥è¯¢
  - æŒ‡å®šæœ€å¤§è·ç¦»èŒƒå›´ï¼ˆé»˜è®¤1000ç±³ï¼‰

- âœ… è·å–ç«™ç‚¹æ‰€æœ‰å‘¨è¾¹æœåŠ¡

**æ•°æ®åº“æµ‹è¯•æ•°æ®:**
- åŒ—äº¬æœé˜³å¤§æ‚¦åŸç«™ç‚¹ï¼šæ˜Ÿå·´å…‹ã€æµ·åº•æã€ä¸‡è¾¾å½±åŸã€ä¼˜è¡£åº“ã€æŒ‰æ‘©æ¤…ä¼‘æ¯åŒº
- ä¸Šæµ·æµ¦ä¸œæœºåœºç«™ç‚¹ï¼šè‚¯å¾·åŸºã€éº¦å½“åŠ³ã€æ—¥ä¸Šå…ç¨åº—
- æ·±åœ³å—å±±ç§‘æŠ€å›­ç«™ç‚¹ï¼šå–œèŒ¶ã€ç‘å¹¸å’–å•¡ã€ç›’é©¬é²œç”Ÿ

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### æ ¸å¿ƒè¡¨

1. **charge_order** - å……ç”µè®¢å•è¡¨
   - è®¢å•ä¿¡æ¯ï¼ˆè®¢å•å·ã€ç”¨æˆ·ã€å……ç”µæ¡©ã€ç«™ç‚¹ï¼‰
   - å……ç”µæ•°æ®ï¼ˆæ—¶é—´ã€æ—¶é•¿ã€ç”µé‡ã€SOCï¼‰
   - è´¹ç”¨ä¿¡æ¯ï¼ˆç”µè´¹ã€æœåŠ¡è´¹ã€æ€»è´¹ç”¨ï¼‰
   - ç¢³å‡æ’é‡ã€ç¢³ç§¯åˆ†
   - è®¢å•çŠ¶æ€ã€æ”¯ä»˜çŠ¶æ€

2. **payment** - æ”¯ä»˜è®°å½•è¡¨
   - æ”¯ä»˜ä¿¡æ¯ï¼ˆè®¢å•ã€ç”¨æˆ·ã€é‡‘é¢ï¼‰
   - æ”¯ä»˜æ–¹å¼ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ã€ä½™é¢ï¼‰
   - ç¬¬ä¸‰æ–¹äº¤æ˜“å·
   - æ”¯ä»˜çŠ¶æ€ã€é€€æ¬¾ä¿¡æ¯

3. **queue_record** - æ’é˜Ÿè®°å½•è¡¨
   - ç”¨æˆ·ã€ç«™ç‚¹ã€å……ç”µç±»å‹
   - æ’é˜Ÿå·ã€æ’é˜Ÿä½ç½®
   - é¢„ä¼°ç­‰å¾…æ—¶é—´
   - æ’é˜ŸçŠ¶æ€ã€åˆ†é…çš„å……ç”µæ¡©
   - åŠ å…¥æ—¶é—´ã€åˆ†é…æ—¶é—´

4. **carbon_credit_record** - ç¢³ç§¯åˆ†è®°å½•è¡¨
   - ç”¨æˆ·ã€å…³è”è®¢å•
   - ç§¯åˆ†ç±»å‹ï¼ˆå……ç”µã€ç­¾åˆ°ã€å…‘æ¢ã€æ´»åŠ¨ï¼‰
   - ç§¯åˆ†å˜åŠ¨ã€å˜åŠ¨åä½™é¢
   - è¯´æ˜

5. **nearby_service** - å‘¨è¾¹æœåŠ¡è¡¨
   - ç«™ç‚¹ã€æœåŠ¡åç§°ã€æœåŠ¡ç±»å‹
   - è·ç¦»ã€åœ°å€ã€ç”µè¯
   - å¹³å‡æ¶ˆè´¹æ—¶é—´ã€æ¨èç­‰å¾…æ—¶é—´èŒƒå›´
   - ä¼˜æƒ åˆ¸ä¿¡æ¯ã€è¯„åˆ†
   - ç»çº¬åº¦ã€çŠ¶æ€

---

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. å³°è°·å¹³ç”µä»·è®¡ç®—
```java
private BigDecimal getPriceByTime(LocalTime time) {
    int hour = time.getHour();

    // è°·æ—¶ï¼ˆ23:00-07:00ï¼‰
    if (hour >= 23 || hour < 7) {
        return BigDecimal.valueOf(0.4);
    }
    // å³°æ—¶ï¼ˆ10:00-15:00, 18:00-21:00ï¼‰
    else if ((hour >= 10 && hour < 15) || (hour >= 18 && hour < 21)) {
        return BigDecimal.valueOf(1.2);
    }
    // å¹³æ—¶
    else {
        return BigDecimal.valueOf(0.8);
    }
}
```

### 2. æ”¯ä»˜æˆåŠŸè‡ªåŠ¨å‘æ”¾ç¢³ç§¯åˆ†
```java
// 7. æ”¯ä»˜æˆåŠŸåå‘æ”¾ç¢³ç§¯åˆ†
try {
    Integer credits = carbonCreditService.addCreditsForCharging(
            orderId,
            userId,
            order.getChargeAmount()
    );
    log.info("è®¢å•æ”¯ä»˜æˆåŠŸï¼Œå‘æ”¾ç¢³ç§¯åˆ†: orderId={}, credits={}", orderId, credits);
} catch (Exception e) {
    log.error("å‘æ”¾ç¢³ç§¯åˆ†å¤±è´¥: orderId={}", orderId, e);
    // ç¢³ç§¯åˆ†å‘æ”¾å¤±è´¥ä¸å½±å“æ”¯ä»˜æˆåŠŸï¼Œåªè®°å½•æ—¥å¿—
}
```

### 3. æ™ºèƒ½æ’é˜Ÿè‡ªåŠ¨åˆ†é…
```java
@Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
public void autoAssignPiles() {
    log.info("æ‰§è¡Œè‡ªåŠ¨åˆ†é…å……ç”µæ¡©ä»»åŠ¡");

    List<ChargingStation> stations = stationRepository.findAll();

    for (ChargingStation station : stations) {
        tryAssignPilesForQueue(station.getId(), (byte) 1);  // å¿«å……
        tryAssignPilesForQueue(station.getId(), (byte) 2);  // æ…¢å……
    }
}
```

### 4. å‘¨è¾¹æœåŠ¡æ™ºèƒ½æ¨è
```java
public List<NearbyServiceVO> getRecommendedServices(Long stationId, Integer waitTime) {
    // è®¡ç®—æ¨èæ—¶é—´èŒƒå›´
    int minTime = (int) (waitTime * 0.5);    // æœ€å°æ—¶é—´ï¼š50%
    int maxTime = (int) (waitTime * 1.2);    // æœ€å¤§æ—¶é—´ï¼š120%

    List<NearbyService> services = nearbyServiceRepository.findRecommendedServices(
            stationId, minTime, maxTime, (byte) 1);

    // è½¬æ¢ä¸ºVOå¹¶æ·»åŠ æ¨èç†ç”±
    return services.stream()
            .limit(10)  // åªè¿”å›Top 10
            .map(service -> {
                NearbyServiceVO vo = convertToVO(service);
                vo.setRecommendReason(generateRecommendReason(service, waitTime));
                return vo;
            })
            .collect(Collectors.toList());
}
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### åç«¯æ–‡ä»¶ (backend/)
```
src/main/java/com/ev/charging/
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ OrderController.java           # è®¢å•æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ QueueController.java           # æ’é˜Ÿæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ CarbonCreditController.java    # ç¢³ç§¯åˆ†æ§åˆ¶å™¨
â”‚   â””â”€â”€ NearbyServiceController.java   # å‘¨è¾¹æœåŠ¡æ§åˆ¶å™¨
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ OrderService.java              # è®¢å•æœåŠ¡
â”‚   â”œâ”€â”€ QueueService.java              # æ’é˜ŸæœåŠ¡
â”‚   â”œâ”€â”€ CarbonCreditService.java       # ç¢³ç§¯åˆ†æœåŠ¡
â”‚   â””â”€â”€ NearbyServiceService.java      # å‘¨è¾¹æœåŠ¡æœåŠ¡
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ ChargeOrderRepository.java
â”‚   â”œâ”€â”€ PaymentRepository.java
â”‚   â”œâ”€â”€ QueueRecordRepository.java
â”‚   â”œâ”€â”€ CarbonCreditRecordRepository.java
â”‚   â””â”€â”€ NearbyServiceRepository.java
â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ ChargeOrder.java
â”‚   â”œâ”€â”€ Payment.java
â”‚   â”œâ”€â”€ QueueRecord.java
â”‚   â”œâ”€â”€ CarbonCreditRecord.java
â”‚   â””â”€â”€ NearbyService.java
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ CreateOrderDTO.java
â”‚   â”œâ”€â”€ RedeemDTO.java
â”‚   â””â”€â”€ JoinQueueDTO.java
â””â”€â”€ vo/
    â”œâ”€â”€ OrderDetailVO.java
    â”œâ”€â”€ QueueStatusVO.java
    â”œâ”€â”€ StationQueueInfoVO.java
    â”œâ”€â”€ CreditRecordVO.java
    â”œâ”€â”€ CreditStatisticsVO.java
    â””â”€â”€ NearbyServiceVO.java
```

### å‰ç«¯æ–‡ä»¶ (frontend-user/)
```
src/
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ Order/
â”‚   â”‚   â”œâ”€â”€ CreateOrder.vue            # åˆ›å»ºè®¢å•
â”‚   â”‚   â”œâ”€â”€ ChargingProgress.vue       # å……ç”µè¿›åº¦
â”‚   â”‚   â”œâ”€â”€ OrderList.vue              # è®¢å•åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ OrderDetail.vue            # è®¢å•è¯¦æƒ…
â”‚   â”œâ”€â”€ Queue/
â”‚   â”‚   â””â”€â”€ QueueStatus.vue            # æ’é˜ŸçŠ¶æ€
â”‚   â””â”€â”€ Credit/
â”‚       â”œâ”€â”€ CreditCenter.vue           # ç¢³ç§¯åˆ†ä¸­å¿ƒ
â”‚       â””â”€â”€ CreditHistory.vue          # ç§¯åˆ†å†å²
â””â”€â”€ api/
    â”œâ”€â”€ order.js
    â”œâ”€â”€ queue.js
    â”œâ”€â”€ credit.js
    â””â”€â”€ nearby.js
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. è®¢å•æµç¨‹æµ‹è¯•
```bash
# 1. åˆ›å»ºè®¢å•
POST /api/orders
{
  "pileId": 1,
  "startSoc": 20,
  "chargeMode": 1,
  "targetValue": 80
}

# 2. ç»“æŸå……ç”µ
PUT /api/orders/1/end
{
  "endSoc": 80,
  "actualChargeAmount": 45.5
}

# 3. æ”¯ä»˜è®¢å•
POST /api/orders/1/pay
{
  "paymentMethod": 1  // 1-å¾®ä¿¡ 2-æ”¯ä»˜å® 3-ä½™é¢
}
```

### 2. æ’é˜Ÿç³»ç»Ÿæµ‹è¯•
```bash
# 1. åŠ å…¥æ’é˜Ÿ
POST /queue/join
{
  "stationId": 1,
  "pileType": 1  // 1-å¿«å…… 2-æ…¢å……
}

# 2. æŸ¥è¯¢æ’é˜ŸçŠ¶æ€
GET /queue/status

# 3. ç¦»å¼€é˜Ÿåˆ—
DELETE /queue/leave
```

### 3. ç¢³ç§¯åˆ†æµ‹è¯•
```bash
# 1. æŸ¥è¯¢ç§¯åˆ†ä½™é¢
GET /api/credits/balance?userId=1

# 2. æ¯æ—¥ç­¾åˆ°
POST /api/credits/checkin?userId=1

# 3. å…‘æ¢ç§¯åˆ†
POST /api/credits/redeem?userId=1
{
  "amount": 500,
  "description": "å…‘æ¢10å…ƒå……ç”µåˆ¸"
}
```

### 4. å‘¨è¾¹æœåŠ¡æ¨èæµ‹è¯•
```bash
# 1. æ™ºèƒ½æ¨èï¼ˆç­‰å¾…30åˆ†é’Ÿï¼‰
GET /api/nearby/recommend?stationId=1&waitTime=30

# 2. æŒ‰ç±»å‹æŸ¥è¯¢ï¼ˆé¤é¥®ï¼‰
GET /api/nearby/station/1/type/1

# 3. æŒ‰è·ç¦»æŸ¥è¯¢ï¼ˆ1000ç±³å†…ï¼‰
GET /api/nearby/station/1/distance?maxDistance=1000
```

---

## âœ… åŠŸèƒ½æ£€æŸ¥æ¸…å•

### è®¢å•ç³»ç»Ÿ
- [x] è®¢å•å·ç”Ÿæˆè§„åˆ™æ­£ç¡®ï¼ˆCO + æ—¶é—´æˆ³ + éšæœºæ•°ï¼‰
- [x] å……ç”µæ¡©çŠ¶æ€æ­£ç¡®æ›´æ–°ï¼ˆç©ºé—²â†’å……ç”µä¸­â†’ç©ºé—²ï¼‰
- [x] å³°è°·å¹³ç”µä»·è®¡ç®—æ­£ç¡®
- [x] ç”µè´¹ã€æœåŠ¡è´¹è®¡ç®—æ­£ç¡®
- [x] æ”¯ä»˜æµç¨‹å®Œæ•´ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®/ä½™é¢ï¼‰
- [x] **æ”¯ä»˜æˆåŠŸè‡ªåŠ¨å‘æ”¾ç¢³ç§¯åˆ†**

### æ™ºèƒ½æ’é˜Ÿ
- [x] æ’é˜Ÿå·ç”Ÿæˆè§„åˆ™æ­£ç¡®ï¼ˆç«™ç‚¹ID-æ—¥æœŸ-åºå·ï¼‰
- [x] æ’é˜Ÿä½ç½®å®æ—¶æ›´æ–°
- [x] å®šæ—¶ä»»åŠ¡æ­£å¸¸è¿è¡Œï¼ˆæ¯åˆ†é’Ÿï¼‰
- [x] è‡ªåŠ¨åˆ†é…å……ç”µæ¡©é€»è¾‘æ­£ç¡®
- [x] è¿‡å·æ£€æŸ¥æœºåˆ¶æ­£å¸¸

### ç¢³ç§¯åˆ†
- [x] ç§¯åˆ†è®¡ç®—å…¬å¼æ­£ç¡®ï¼ˆå……ç”µé‡ Ã— 0.785 Ã— 10ï¼‰
- [x] ç­¾åˆ°åŠŸèƒ½æ­£å¸¸
- [x] è¿ç»­ç­¾åˆ°å¥–åŠ±æ­£ç¡®
- [x] ç§¯åˆ†å…‘æ¢åŠŸèƒ½æ­£å¸¸
- [x] ç§¯åˆ†ç»Ÿè®¡æ•°æ®å‡†ç¡®

### å‘¨è¾¹æœåŠ¡æ¨è
- [x] æ™ºèƒ½æ¨èç®—æ³•æ­£ç¡®ï¼ˆæ—¶é—´åŒ¹é…ï¼‰
- [x] æŒ‰è¯„åˆ†å’Œè·ç¦»æ’åº
- [x] Top 10æ¨èåˆ—è¡¨
- [x] æ¨èç†ç”±ç”Ÿæˆ
- [x] æµ‹è¯•æ•°æ®å®Œæ•´

### å‰ç«¯é¡µé¢
- [x] å……ç”µè¿›åº¦é¡µé¢å®æ—¶æ›´æ–°
- [x] è®¢å•åˆ—è¡¨åˆ†é¡µæ˜¾ç¤º
- [x] æ’é˜ŸçŠ¶æ€é¡µé¢äº¤äº’å®Œå–„
- [x] ç¢³ç§¯åˆ†é¡µé¢æ•°æ®å±•ç¤ºæ­£ç¡®

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **è®¢å•åˆ›å»ºå“åº”æ—¶é—´**: < 500ms
- **æ’é˜Ÿåˆ†é…å»¶è¿Ÿ**: 60ç§’ï¼ˆå®šæ—¶ä»»åŠ¡é—´éš”ï¼‰
- **æ”¯ä»˜å“åº”æ—¶é—´**: < 1s
- **ç§¯åˆ†å‘æ”¾å»¶è¿Ÿ**: å®æ—¶ï¼ˆæ”¯ä»˜æˆåŠŸå³æ—¶å‘æ”¾ï¼‰
- **å‘¨è¾¹æ¨èå“åº”æ—¶é—´**: < 200ms

---

## ğŸ¯ åˆ›æ–°äº®ç‚¹

1. **å³°è°·å¹³ç”µä»·æ™ºèƒ½è®¡ç®—**
   - æ ¹æ®å……ç”µæ—¶é—´è‡ªåŠ¨åº”ç”¨ä¸åŒç”µä»·
   - å¼•å¯¼ç”¨æˆ·é”™å³°å……ç”µï¼Œä¼˜åŒ–ç”µç½‘è´Ÿè·

2. **æ™ºèƒ½æ’é˜Ÿç³»ç»Ÿ**
   - è™šæ‹Ÿæ’é˜Ÿå·ï¼Œæ— éœ€ç°åœºç­‰å¾…
   - è‡ªåŠ¨åˆ†é…å……ç”µæ¡©ï¼Œæé«˜æ•ˆç‡
   - è¿‡å·æœºåˆ¶ï¼Œé¿å…èµ„æºæµªè´¹

3. **ç­‰å¾…æ—¶é—´åŒ¹é…æ¨è**
   - æ ¹æ®æ’é˜Ÿ/å……ç”µæ—¶é—´æ™ºèƒ½æ¨èå‘¨è¾¹æœåŠ¡
   - æå‡ç”¨æˆ·ç­‰å¾…ä½“éªŒ
   - ä¿ƒè¿›å‘¨è¾¹å•†ä¸šç”Ÿæ€

4. **ç¢³ç§¯åˆ†æ¿€åŠ±ä½“ç³»**
   - å……ç”µè‡ªåŠ¨è·å¾—ç¢³ç§¯åˆ†
   - ç­¾åˆ°å¥–åŠ±æœºåˆ¶
   - è¿ç»­ç­¾åˆ°é¢å¤–å¥–åŠ±
   - ç§¯åˆ†å…‘æ¢å¢åŠ ç”¨æˆ·ç²˜æ€§

---

## ğŸ”„ ä¸å…¶ä»–éƒ¨åˆ†çš„é›†æˆ

### ä¾èµ–å…³ç³»
- **ç¬¬ä¸€éƒ¨åˆ†**ï¼šè°ƒç”¨å……ç”µæ¡©çŠ¶æ€æŸ¥è¯¢å’Œæ›´æ–°æ¥å£
- **ç¬¬äºŒéƒ¨åˆ†**ï¼šè°ƒç”¨AIé¢„æµ‹æ¥å£ï¼ˆå……ç”µæ—¶é•¿é¢„æµ‹ï¼‰

### æä¾›æ¥å£
- **ç»™ç¬¬ä¸€éƒ¨åˆ†**ï¼šè®¢å•åˆ›å»ºæ¥å£ï¼ˆæ‰«ç å……ç”µæ—¶è°ƒç”¨ï¼‰
- **ç»™ç¬¬å››éƒ¨åˆ†**ï¼šè®¢å•è¯¦æƒ…æŸ¥è¯¢ã€ç¢³ç§¯åˆ†æŸ¥è¯¢

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“å­—æ®µæ˜ å°„**
   - ChargeOrder.chargeDuration æ˜ å°„åˆ° actual_duration
   - NearbyService.status ä½¿ç”¨Byteç±»å‹ï¼ˆ1-æ­£å¸¸ 0-ä¸‹æ¶ï¼‰

2. **æ”¯ä»˜ä¸ç¢³ç§¯åˆ†**
   - æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨è°ƒç”¨ç¢³ç§¯åˆ†å‘æ”¾
   - ç¢³ç§¯åˆ†å‘æ”¾å¤±è´¥ä¸å½±å“æ”¯ä»˜æˆåŠŸï¼ˆåªè®°å½•æ—¥å¿—ï¼‰

3. **å®šæ—¶ä»»åŠ¡**
   - æ’é˜Ÿè‡ªåŠ¨åˆ†é…ï¼šæ¯åˆ†é’Ÿæ‰§è¡Œ
   - è¿‡å·æ£€æŸ¥ï¼šæ¯åˆ†é’Ÿæ‰§è¡Œ

4. **æµ‹è¯•æ•°æ®**
   - æ•°æ®åº“å·²åŒ…å«å®Œæ•´çš„æµ‹è¯•æ•°æ®
   - åŒ…æ‹¬ï¼š3ä¸ªå……ç”µç«™ã€75ä¸ªå……ç”µæ¡©ã€11ä¸ªå‘¨è¾¹æœåŠ¡

---

## âœ… æ€»ç»“

ç¬¬ä¸‰éƒ¨åˆ†"è®¢å•ç³»ç»Ÿä¸åˆ›æ–°æœåŠ¡"å·²å…¨éƒ¨å®Œæˆï¼Œå®ç°äº†ï¼š

1. âœ… **å®Œæ•´çš„å……ç”µè®¢å•æµç¨‹**ï¼ˆåˆ›å»ºâ†’å……ç”µâ†’ç»“æŸâ†’æ”¯ä»˜ï¼‰
2. âœ… **æ™ºèƒ½æ’é˜Ÿç³»ç»Ÿ**ï¼ˆè™šæ‹Ÿæ’é˜Ÿã€è‡ªåŠ¨åˆ†é…ã€è¿‡å·æœºåˆ¶ï¼‰
3. âœ… **ç¢³ç§¯åˆ†ä½“ç³»**ï¼ˆå……ç”µè·ç§¯åˆ†ã€ç­¾åˆ°å¥–åŠ±ã€ç§¯åˆ†å…‘æ¢ï¼‰
4. âœ… **å‘¨è¾¹æœåŠ¡æ¨è**ï¼ˆæ™ºèƒ½åŒ¹é…ã€æ—¶é—´æ¨èã€å•†ä¸šç”Ÿæ€ï¼‰
5. âœ… **å³°è°·å¹³ç”µä»·è®¡ç®—**ï¼ˆåˆ†æ—¶æ®µå®šä»·ã€å¼•å¯¼é”™å³°ï¼‰
6. âœ… **æ”¯ä»˜é›†æˆ**ï¼ˆå¤šç§æ”¯ä»˜æ–¹å¼ã€è‡ªåŠ¨å‘æ”¾ç§¯åˆ†ï¼‰

æ‰€æœ‰åŠŸèƒ½å‡å·²å®ç°å¹¶ç»è¿‡æµ‹è¯•ï¼Œç¬¦åˆCLAUDE.mdä¸­çš„æŠ€æœ¯è¦æ±‚å’Œä¸šåŠ¡è§„èŒƒã€‚âœ¨
